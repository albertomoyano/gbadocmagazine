' Gambas module file

Private ContenidoArt As Result

Public Sub ObtenerIdNuevoArticulo()

  Dim Idn As Integer
  Dim MaxId As Variant

  MaxId = m_OnOff_y_Red.meConn.Exec("SELECT MAX(id) FROM articulos LIMIT 1")

  If MaxId["MAX(id)"] = Null Then
    Idn = 0
  Else
    Idn = CInt(MaxId["MAX(id)"]) + 1
  Endif

  FMain.idArticulo.Text = Idn

End

Public Sub GuardarArticuloPrimeraVez()

  ContenidoArt = m_OnOff_y_Red.meConn.Create("articulos")

  GuardarArticulo()
  ContenidoArt.Update
  m_OnOff_y_Red.meConn.Commit()
  RefrescarTableViewArticulos()
  Message.Info("Cambios guardados correctamente.")

Catch
  Message.Error("Error al intentar guardar la entrada: " & Error.Text)

End

Public Sub GuardarCambiosArticulo()

  ContenidoArt = m_OnOff_y_Red.meConn.Edit("articulos", "id=" & FMain.idArticulo.Text)

  If Not ContenidoArt.Available Then
    Message.Error("No se encontró el artículo para editar.")
    Return
  Endif

  GuardarArticulo()
  ContenidoArt.Update
  m_OnOff_y_Red.meConn.Commit()
  RefrescarTableViewArticulos()
  Message.Info("Cambios guardados correctamente.")

Catch
  Message.Error("Error al guardar los cambios: " & Error.Text)

End

Public Sub GuardarArticulo()

  ContenidoArt = m_OnOff_y_Red.meConn.Edit("articulos", "id=" & FMain.idArticulo.Text)

  ContenidoArt!id = FMain.idArticulo.Text
  ContenidoArt!id_revistas = FMain.idRevista.Text
  ContenidoArt!txtArticuloTitulo = FMain.txtArticuloTitulo.Text
  ContenidoArt!txtArticuloTituloEn = FMain.txtArticuloTituloEn.Text
  ContenidoArt!txtArticuloTituloCorto = FMain.txtArticuloTituloCorto.Text
  ContenidoArt!txtArticuloTituloCortoEn = FMain.txtArticuloTituloCortoEn.Text
  ContenidoArt!txtArticuloSubtitulo = FMain.txtArticuloSubtitulo.Text
  ContenidoArt!txtArticuloSubtituloEn = FMain.txtArticuloSubtituloEn.Text
  ' ContenidoArt!txt = FMain.txt.Text
  ' ContenidoArt!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text
  ' Contenido!txt = FMain.txt.Text

End

Public Sub MostrarArticulosEnTableViewArticulos(iRow As Integer)

  With FMain
    .idArticulo.Text = .gbMetadatosArticulos[iRow, 0].Text
    .idRevista.Text = .gbMetadatosArticulos[iRow, 1].Text
    .txtArticuloTitulo.Text = .gbMetadatosArticulos[iRow, 2].Text
    .txtArticuloTituloEn.Text = .gbMetadatosArticulos[iRow, 3].Text
    .txtArticuloTituloCorto.Text = .gbMetadatosArticulos[iRow, 4].Text
    .txtArticuloTituloCortoEn.Text = .gbMetadatosArticulos[iRow, 5].Text
    .txtArticuloSubtitulo.Text = .gbMetadatosArticulos[iRow, 6].Text
    .txtArticuloSubtituloEn.Text = .gbMetadatosArticulos[iRow, 7].Text
    ' agregar todos los restantes
  End With

End

Public Sub ConfigurarTableViewArticulos(grid As GridView)

  With grid
    .Header = True
    .Grid = True
    .Columns.Count = 50

    ' Configuración de columnas
    For i As Integer = 0 To 49
      Select Case i
        Case 2
          .Columns[i].Title = "Título"
          .Columns[i].Width = 900
        Case Else
          .Columns[i].Title = ""
          .Columns[i].Width = 0
      End Select
    Next
  End With

End

Public Sub RefrescarTableViewArticulos()

  FMain.gbMetadatosArticulos.Clear
  ContenidoArt = m_OnOff_y_Red.meConn.Exec("SELECT * FROM articulos WHERE id_revistas = &1", FMain.idMetadatoRevista.Text)
  FMain.gbMetadatosArticulos.Rows.Count = ContenidoArt.Count
  FMain.gbMetadatosArticulos.Refresh

End
