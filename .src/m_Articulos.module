' Gambas module file

Private iIDProyecto As Integer
Private Contenido As Result

Public Sub ObtenerIdNuevoArticulo()

  Dim Idn As Integer
  Dim MaxId As Variant

  MaxId = m_OnOff_y_Red.meConn.Exec("SELECT MAX(id) FROM articulos LIMIT 1")

  If MaxId["MAX(id)"] = Null Then
    Idn = 0
  Else
    Idn = CInt(MaxId["MAX(id)"]) + 1
  Endif

  FMain.idArticulo.Text = Idn
  FMain.idProyectoArticulo.Text = FMain.idProyecto.Text

End

Public Sub GuardarArticuloPrimeraVez()

  Contenido = m_OnOff_y_Red.meConn.Create("articulos", "id=" & FMain.idArticulo.Text)

  Contenido!id_proyecto = CInt(FMain.idProyectoArticulo.Text)' tomo el valor del id del proyecto
  Contenido!txtArticuloTitulo = FMain.txtArticuloTitulo.Text
  Contenido!txtArticuloTituloEn = FMain.txtArticuloTituloEn.Text
  Contenido!txtArticuloTituloCorto = FMain.txtArticuloTituloCorto.Text
  Contenido!txtArticuloTituloCortoEn = FMain.txtArticuloTituloCortoEn.Text
  Contenido!txtArticuloSubtitulo = FMain.txtArticuloSubtitulo.Text
  Contenido!txtArticuloSubtituloEn = FMain.txtArticuloSubtituloEn.Text

  Message.Info("Cambios guardados correctamente.")
  Contenido.Update
  m_OnOff_y_Red.meConn.Commit()

Catch
  Message.Error("Error al guardar cambios: " & Error.Text)

End

Public Sub GuardarCambiosArticulo()

  Contenido = m_OnOff_y_Red.meConn.Edit("articulos", "id=" & FMain.idArticulo.Text)

  Contenido!txtArticuloTitulo = FMain.txtArticuloTitulo.Text
  Contenido!txtArticuloTituloEn = FMain.txtArticuloTituloEn.Text
  Contenido!txtArticuloTituloCorto = FMain.txtArticuloTituloCorto.Text
  Contenido!txtArticuloTituloCortoEn = FMain.txtArticuloTituloCortoEn.Text
  Contenido!txtArticuloSubtitulo = FMain.txtArticuloSubtitulo.Text
  Contenido!txtArticuloSubtituloEn = FMain.txtArticuloSubtituloEn.Text

  Message.Info("Cambios guardados correctamente.")
  Contenido.Update
  m_OnOff_y_Red.meConn.Commit()

Catch
  Message.Error("Error al guardar cambios: " & Error.Text)

End
