' Gambas module file

Private iIDarticulo As Integer
Private Contenido As Result

Public Sub ObtenerIdNuevoAutor()

  Dim Idn As Integer
  Dim MaxId As Variant

  MaxId = m_OnOff_y_Red.meConn.Exec("SELECT MAX(id) FROM autores LIMIT 1")

  If MaxId["MAX(id)"] = Null Then
    Idn = 0
  Else
    Idn = CInt(MaxId["MAX(id)"]) + 1
  Endif

  FMain.idAutor.Text = Idn

End

Public Sub RefrescarTableViewArticulos()

  FMain.TableViewAutores.Clear
  Contenido = m_OnOff_y_Red.meConn.Exec("SELECT * FROM autores")'
  FMain.TableViewAutores.Rows.Count = Contenido.Count

End

Public Sub LlenarComboBoxArticulos()

  Dim rConsulta As Result
  Dim sSQL As String

  sSQL = "SELECT id, txtArticuloTitulo FROM articulos"
  rConsulta = m_OnOff_y_Red.meConn.Exec(sSQL)
  FMain.ComboBoxArticuloAsociado.Clear

  If rConsulta.Available Then
    Repeat
      ' Opción 1: Usar la propiedad Tag para guardar el ID
      FMain.ComboBoxArticuloAsociado.Add(rConsulta["txtArticuloTitulo"], rConsulta["id"])
      rConsulta.MoveNext()
    Until rConsulta.Available = False
  Else
    Message.Warning("No hay artículos para mostrar.")
  Endif

Catch
  Message.Error("Error al cargar artículos: " & Error.Text)

End
