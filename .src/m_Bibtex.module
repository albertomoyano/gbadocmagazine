' Gambas module file

Private Contenido As Result

Public Sub ObtenerIdNuevoBibtex()

  ' Verificar si hay un proyecto activo
  If Trim(FMain.txtProyecto.Text) = "" Then
    Message.Info("No hay un proyecto en curso. Por favor, abra o cree un proyecto antes de continuar.")
    Return
  Endif

  ' Solo si hay proyecto se ejecuta lo siguiente:
  Dim Idn As Integer
  Dim MaxId As Variant

  MaxId = m_OnOff_y_Red.meConn.Exec("SELECT MAX(id) FROM bibtex LIMIT 1")

  If MaxId["MAX(id)"] = Null Then
    Idn = 0
  Else
    Idn = CInt(MaxId["MAX(id)"]) + 1
  Endif

  FMain.idBibtex.Text = Idn
  FMain.idProyectoBibtex.Text = FMain.idMetadatoRevista.Text

  FMain.BtnNuevoBib.Visible = False
  FMain.btnGuardarBib.Visible = True
  FMain.btnGuardarCambiosBib.Visible = False
  FMain.BtnEliminarBib.Visible = False

End

Public Sub ConfigurarTableViewBibtexEnCurso(grid As GridView)

  With grid
    .Header = True
    .Grid = True
    .Columns.Count = 110

    ' Configuración de columnas
    For i As Integer = 0 To 109
      Select Case i
        Case 2
          .Columns[i].Title = "Autor"
          .Columns[i].Width = 250
        Case 3
          .Columns[i].Title = "Título"
          .Columns[i].Width = 350
        Case 50
          .Columns[i].Title = "Año"
          .Columns[i].Width = 100
        Case 51
          .Columns[i].Title = "Fecha"
          .Columns[i].Width = 100
        Case Else
          .Columns[i].Title = ""
          .Columns[i].Width = 0
      End Select
    Next
  End With

End

Public Sub RefrescarTableViewBibtexEnCurso()

  FMain.gvReferenciasEnCurso.Clear
  Contenido = m_OnOff_y_Red.meConn.Exec("SELECT * FROM bibtex WHERE id_revistas = &1", FMain.idMetadatoRevista.Text)
  FMain.gvReferenciasEnCurso.Rows.Count = Contenido.Count

End

Public Sub GuardarBibtexPrimeraVez()

  Contenido = m_OnOff_y_Red.meConn.Create("bibtex")

  GuardarCamposBib()
  Contenido.Update
  m_OnOff_y_Red.meConn.Commit()
  RefrescarTableViewBibtexEnCurso()
  Message.Info("Cambios guardados correctamente.")
  LimpiarCamposBIB()
  RefrescarTableViewBibtexEnCurso()

Catch
  Message.Error("Error al guardar cambios: " & Error.Text)

End

Public Sub GuardarCambiosEnBibtex()

  Contenido = m_OnOff_y_Red.meConn.Edit("bibtex", "id=" & FMain.idBibtex.Text)

  GuardarCamposBib()
  Contenido.Update
  m_OnOff_y_Red.meConn.Commit()
  LimpiarCamposBIB()
  RefrescarTableViewBibtexEnCurso()

  ' Informar al usuario que los cambios se guardaron con éxito
  Message.Info("Los cambios se guardaron con éxito.")

End

Public Sub GuardarCamposBib()

  Contenido!id = CInt(FMain.idBibtex.Text)
  Contenido!id_revistas = CInt(FMain.idMetadatoRevista.Text)
  Contenido!cmbTipoCSL = FMain.cmbTipoCSL.Text
  Contenido!txtClaveBibtex = FMain.txtClaveBibtex.Text
  Contenido!cmbTipoDeEntrada = FMain.cmbTipoDeEntrada.Text
  Contenido!txtAuthor = FMain.txtAuthor.Text
  ' poner los que faltan

End

Public Sub RellenarComboBoxBibTeX()

  FMain.cmbTipoDeEntrada.Add("")
  FMain.cmbTipoDeEntrada.Add("article")
  FMain.cmbTipoDeEntrada.Add("incollection")
  FMain.cmbTipoDeEntrada.Add("book")
  FMain.cmbTipoDeEntrada.Add("thesis")
  FMain.cmbTipoDeEntrada.Add("online")
  FMain.cmbTipoDeEntrada.Add("inproceedings")
  FMain.cmbTipoDeEntrada.Add("mvbook")
  FMain.cmbTipoDeEntrada.Add("inbook")
  FMain.cmbTipoDeEntrada.Add("bookinbook")
  FMain.cmbTipoDeEntrada.Add("suppbook")
  FMain.cmbTipoDeEntrada.Add("booklet")
  FMain.cmbTipoDeEntrada.Add("collection")
  FMain.cmbTipoDeEntrada.Add("mvcollection")
  FMain.cmbTipoDeEntrada.Add("suppcollection")
  FMain.cmbTipoDeEntrada.Add("manual")
  FMain.cmbTipoDeEntrada.Add("misc")
  FMain.cmbTipoDeEntrada.Add("patent")
  FMain.cmbTipoDeEntrada.Add("periodical")
  FMain.cmbTipoDeEntrada.Add("suppperiodical")
  FMain.cmbTipoDeEntrada.Add("proceedings")
  FMain.cmbTipoDeEntrada.Add("mvproceedings")
  FMain.cmbTipoDeEntrada.Add("reference")
  FMain.cmbTipoDeEntrada.Add("mvreference")
  FMain.cmbTipoDeEntrada.Add("inreference")
  FMain.cmbTipoDeEntrada.Add("report")
  FMain.cmbTipoDeEntrada.Add("set")
  FMain.cmbTipoDeEntrada.Add("unpublished")
  FMain.cmbTipoDeEntrada.Add("xdata")
  FMain.cmbTipoDeEntrada.Add("movie")
  FMain.cmbTipoDeEntrada.Add("conference")
  FMain.cmbTipoDeEntrada.Add("software")

  FMain.cmbHyphenation.Add("")' babel
  FMain.cmbHyphenation.Add("spanish")
  FMain.cmbHyphenation.Add("portuguese")
  FMain.cmbHyphenation.Add("english")
  FMain.cmbHyphenation.Add("french")
  FMain.cmbHyphenation.Add("american")
  FMain.cmbHyphenation.Add("british")
  FMain.cmbHyphenation.Add("afrikaans")
  FMain.cmbHyphenation.Add("albanian")
  FMain.cmbHyphenation.Add("arabic")
  FMain.cmbHyphenation.Add("armenian")
  FMain.cmbHyphenation.Add("austrian")
  FMain.cmbHyphenation.Add("bahasa")
  FMain.cmbHyphenation.Add("basque")
  FMain.cmbHyphenation.Add("breton")
  FMain.cmbHyphenation.Add("bulgarian")
  FMain.cmbHyphenation.Add("catalan")
  FMain.cmbHyphenation.Add("croatian")
  FMain.cmbHyphenation.Add("czech")
  FMain.cmbHyphenation.Add("danish")
  FMain.cmbHyphenation.Add("dutch")
  FMain.cmbHyphenation.Add("esperanto")
  FMain.cmbHyphenation.Add("estonian")
  FMain.cmbHyphenation.Add("finnish")
  FMain.cmbHyphenation.Add("galician")
  FMain.cmbHyphenation.Add("german")
  FMain.cmbHyphenation.Add("greek")
  FMain.cmbHyphenation.Add("hebrew")
  FMain.cmbHyphenation.Add("hungarian")
  FMain.cmbHyphenation.Add("icelandic")
  FMain.cmbHyphenation.Add("interlingua")
  FMain.cmbHyphenation.Add("irish")
  FMain.cmbHyphenation.Add("italian")
  FMain.cmbHyphenation.Add("latin")
  FMain.cmbHyphenation.Add("latvian")
  FMain.cmbHyphenation.Add("lithuanian")
  FMain.cmbHyphenation.Add("lowersorbian")
  FMain.cmbHyphenation.Add("magyar")
  FMain.cmbHyphenation.Add("naustrian")
  FMain.cmbHyphenation.Add("ngerman")
  FMain.cmbHyphenation.Add("norsk")
  FMain.cmbHyphenation.Add("nynorsk")
  FMain.cmbHyphenation.Add("polish")
  FMain.cmbHyphenation.Add("romanian")
  FMain.cmbHyphenation.Add("russian")
  FMain.cmbHyphenation.Add("scottish")
  FMain.cmbHyphenation.Add("serbian")
  FMain.cmbHyphenation.Add("slovak")
  FMain.cmbHyphenation.Add("slovene")
  FMain.cmbHyphenation.Add("swedish")
  FMain.cmbHyphenation.Add("turkish")
  FMain.cmbHyphenation.Add("ukrainian")
  FMain.cmbHyphenation.Add("uppersorbian")
  FMain.cmbHyphenation.Add("welsh")

  FMain.cmbLanguage.Add("")
  FMain.cmbLanguage.Add("spanish")
  FMain.cmbLanguage.Add("portuguese")
  FMain.cmbLanguage.Add("english")
  FMain.cmbLanguage.Add("french")
  FMain.cmbLanguage.Add("afrikaans")
  FMain.cmbLanguage.Add("albanian")
  FMain.cmbLanguage.Add("amharic")
  FMain.cmbLanguage.Add("arabic")
  FMain.cmbLanguage.Add("armenian")
  FMain.cmbLanguage.Add("asturian")
  FMain.cmbLanguage.Add("bahasai")
  FMain.cmbLanguage.Add("bahasam")
  FMain.cmbLanguage.Add("basque")
  FMain.cmbLanguage.Add("bengali")
  FMain.cmbLanguage.Add("bidi")
  FMain.cmbLanguage.Add("bosnian")
  FMain.cmbLanguage.Add("breton")
  FMain.cmbLanguage.Add("bulgarian")
  FMain.cmbLanguage.Add("catalan")
  FMain.cmbLanguage.Add("chinese")
  FMain.cmbLanguage.Add("churchslavonic")
  FMain.cmbLanguage.Add("coptic")
  FMain.cmbLanguage.Add("croatian")
  FMain.cmbLanguage.Add("czech")
  FMain.cmbLanguage.Add("danish")
  FMain.cmbLanguage.Add("divehi")
  FMain.cmbLanguage.Add("dutch")
  FMain.cmbLanguage.Add("esperanto")
  FMain.cmbLanguage.Add("estonian")
  FMain.cmbLanguage.Add("farsi")
  FMain.cmbLanguage.Add("finnish")
  FMain.cmbLanguage.Add("friulan")
  FMain.cmbLanguage.Add("galician")
  FMain.cmbLanguage.Add("georgian")
  FMain.cmbLanguage.Add("german")
  FMain.cmbLanguage.Add("greek")
  FMain.cmbLanguage.Add("hebrew")
  FMain.cmbLanguage.Add("hindi")
  FMain.cmbLanguage.Add("hungarian")
  FMain.cmbLanguage.Add("icelandic")
  FMain.cmbLanguage.Add("interlingua")
  FMain.cmbLanguage.Add("irish")
  FMain.cmbLanguage.Add("italian")
  FMain.cmbLanguage.Add("japanese")
  FMain.cmbLanguage.Add("kannada")
  FMain.cmbLanguage.Add("khmer")
  FMain.cmbLanguage.Add("korean")
  FMain.cmbLanguage.Add("kurdish")
  FMain.cmbLanguage.Add("lao")
  FMain.cmbLanguage.Add("latin")
  FMain.cmbLanguage.Add("latvian")
  FMain.cmbLanguage.Add("lithuanian")
  FMain.cmbLanguage.Add("lsorbian")
  FMain.cmbLanguage.Add("macedonian")
  FMain.cmbLanguage.Add("malayalam")
  FMain.cmbLanguage.Add("marathi")
  FMain.cmbLanguage.Add("nko")
  FMain.cmbLanguage.Add("norwegian")
  FMain.cmbLanguage.Add("nynorsk")
  FMain.cmbLanguage.Add("occitan")
  FMain.cmbLanguage.Add("piedmontese")
  FMain.cmbLanguage.Add("polish")
  FMain.cmbLanguage.Add("punjabi")
  FMain.cmbLanguage.Add("romanian")
  FMain.cmbLanguage.Add("romansh")
  FMain.cmbLanguage.Add("russian")
  FMain.cmbLanguage.Add("sami")
  FMain.cmbLanguage.Add("sanskrit")
  FMain.cmbLanguage.Add("scottish")
  FMain.cmbLanguage.Add("serbian")
  FMain.cmbLanguage.Add("slovak")
  FMain.cmbLanguage.Add("slovenian")
  FMain.cmbLanguage.Add("swedish")
  FMain.cmbLanguage.Add("syriac")
  FMain.cmbLanguage.Add("tamil")
  FMain.cmbLanguage.Add("telugu")
  FMain.cmbLanguage.Add("thai")
  FMain.cmbLanguage.Add("tibetan")
  FMain.cmbLanguage.Add("turkish")
  FMain.cmbLanguage.Add("turkmen")
  FMain.cmbLanguage.Add("ukrainian")
  FMain.cmbLanguage.Add("urdu")
  FMain.cmbLanguage.Add("usorbian")
  FMain.cmbLanguage.Add("vietnamese")
  FMain.cmbLanguage.Add("welsh")

  FMain.cmbPagination.Add("")' lo dejo para compatibilidad con referencias viejas
  FMain.cmbPagination.Add("page")
  FMain.cmbPagination.Add("column")
  FMain.cmbPagination.Add("line")
  FMain.cmbPagination.Add("verse")
  FMain.cmbPagination.Add("section")
  FMain.cmbPagination.Add("paragraph")

  FMain.cmbBookPagination.Add("")' lo dejo para compatibilidad con referencias viejas
  FMain.cmbBookPagination.Add("page")
  FMain.cmbBookPagination.Add("column")
  FMain.cmbBookPagination.Add("line")
  FMain.cmbBookPagination.Add("verse")
  FMain.cmbBookPagination.Add("section")
  FMain.cmbBookPagination.Add("paragraph")

  ' FMain.txtORIGLANGUAGE.Add("")
  ' FMain.txtORIGLANGUAGE.Add("spanish")
  ' FMain.txtORIGLANGUAGE.Add("portuguese")
  ' FMain.txtORIGLANGUAGE.Add("french")
  ' FMain.txtORIGLANGUAGE.Add("italian")
  ' FMain.txtORIGLANGUAGE.Add("german")
  ' FMain.txtORIGLANGUAGE.Add("english")
  ' FMain.txtORIGLANGUAGE.Add("british")
  ' FMain.txtORIGLANGUAGE.Add("american")
  ' FMain.txtORIGLANGUAGE.Add("latin")
  ' FMain.txtORIGLANGUAGE.Add("greek")
  ' FMain.txtORIGLANGUAGE.Add("chinese")
  ' FMain.txtORIGLANGUAGE.Add("norwegian")
  ' FMain.txtORIGLANGUAGE.Add("swedish")
  ' FMain.txtORIGLANGUAGE.Add("danish")
  ' FMain.txtORIGLANGUAGE.Add("dutch")
  ' FMain.txtORIGLANGUAGE.Add("japanese")
  ' FMain.txtORIGLANGUAGE.Add("romanian")
  ' FMain.txtORIGLANGUAGE.Add("armenian")
  ' FMain.txtORIGLANGUAGE.Add("korean")
  ' FMain.txtORIGLANGUAGE.Add("russian")
  ' FMain.txtORIGLANGUAGE.Add("latin")
  ' FMain.txtORIGLANGUAGE.Add("czech")
  '
  ' FMain.txtLANGUAGE.Add("")
  ' FMain.txtLANGUAGE.Add("spanish")
  ' FMain.txtLANGUAGE.Add("portuguese")
  ' FMain.txtLANGUAGE.Add("french")
  ' FMain.txtLANGUAGE.Add("italian")
  ' FMain.txtLANGUAGE.Add("german")
  ' FMain.txtLANGUAGE.Add("english")
  ' FMain.txtLANGUAGE.Add("british")
  ' FMain.txtLANGUAGE.Add("american")
  ' FMain.txtLANGUAGE.Add("latin")
  ' FMain.txtLANGUAGE.Add("greek")
  ' FMain.txtLANGUAGE.Add("chinese")
  ' FMain.txtLANGUAGE.Add("norwegian")
  ' FMain.txtLANGUAGE.Add("swedish")
  ' FMain.txtLANGUAGE.Add("danish")
  ' FMain.txtLANGUAGE.Add("dutch")
  ' FMain.txtLANGUAGE.Add("japanese")
  ' FMain.txtLANGUAGE.Add("romanian")
  ' FMain.txtLANGUAGE.Add("armenian")
  ' FMain.txtLANGUAGE.Add("korean")
  ' FMain.txtLANGUAGE.Add("russian")
  ' FMain.txtLANGUAGE.Add("latin")
  ' FMain.txtLANGUAGE.Add("czech")

  FMain.cmbTipoDeTesis.Add("")
  FMain.cmbTipoDeTesis.Add("tifthesis")
  FMain.cmbTipoDeTesis.Add("mathesis")
  FMain.cmbTipoDeTesis.Add("phdthesis")
  FMain.cmbTipoDeTesis.Add("candthesis")
  FMain.cmbTipoDeTesis.Add("ingenieriathesis")
  FMain.cmbTipoDeTesis.Add("magisterthesis")
  FMain.cmbTipoDeTesis.Add("gradothesis")
  FMain.cmbTipoDeTesis.Add("licenciaturathesis")
  FMain.cmbTipoDeTesis.Add("especialthesis")
  FMain.cmbTipoDeTesis.Add("posgradothesis")
  FMain.cmbTipoDeTesis.Add("profesoradothesis")

  ' ' FMain.cbType.Add("@manual (seleccionar)")
  ' ' FMain.cbType.Add("guía de usuario")
  ' ' FMain.cbType.Add("manual técnico")
  ' ' FMain.cbType.Add("número de serie")
  ' ' FMain.cbType.Add("@patent (seleccionar)")
  ' ' FMain.cbType.Add("")
  ' ' FMain.cbType.Add("@report (seleccionar)")
  ' ' FMain.cbType.Add("institución")
  ' ' FMain.cbType.Add("institución")
  '
  ' FMain.CmbRelatedType.Add("")
  ' FMain.CmbRelatedType.Add("reprintof")
  ' FMain.CmbRelatedType.Add("translationof")
  ' FMain.CmbRelatedType.Add("translatedas")
  ' FMain.CmbRelatedType.Add("multivolume")
  '
  ' FMain.cbRelatedTypeRelacion.Add("")
  ' FMain.cbRelatedTypeRelacion.Add("reprintof")
  ' FMain.cbRelatedTypeRelacion.Add("translationof")
  ' FMain.cbRelatedTypeRelacion.Add("translatedas")
  ' FMain.cbRelatedTypeRelacion.Add("multivolume")

  FMain.cmbPubState.Add("")
  FMain.cmbPubState.Add("mimeograph")
  FMain.cmbPubState.Add("photocopy")
  FMain.cmbPubState.Add("digitalprinting")
  FMain.cmbPubState.Add("inpreparation")
  FMain.cmbPubState.Add("submitted")
  FMain.cmbPubState.Add("forthcoming")
  FMain.cmbPubState.Add("inpress")
  FMain.cmbPubState.Add("prepublished")
  FMain.cmbPubState.Add("edauthor")

  ' FMain.cbEDITORTYPE.Add("")
  ' FMain.cbEDITORTYPE.Add("editor")
  ' FMain.cbEDITORTYPE.Add("compiler")
  ' FMain.cbEDITORTYPE.Add("direction")
  ' FMain.cbEDITORTYPE.Add("founder")
  ' FMain.cbEDITORTYPE.Add("continuator")
  ' FMain.cbEDITORTYPE.Add("redactor")
  ' FMain.cbEDITORTYPE.Add("reviser")
  ' FMain.cbEDITORTYPE.Add("collaborator")
  ' FMain.cbEDITORTYPE.Add("cordinator")
  ' FMain.cbEDITORTYPE.Add("organizator")
  '
  ' FMain.cbEDITORTYPEa.Add("")
  ' FMain.cbEDITORTYPEa.Add("editor")
  ' FMain.cbEDITORTYPEa.Add("compiler")
  ' FMain.cbEDITORTYPEa.Add("direction")
  ' FMain.cbEDITORTYPEa.Add("founder")
  ' FMain.cbEDITORTYPEa.Add("continuator")
  ' FMain.cbEDITORTYPEa.Add("redactor")
  ' FMain.cbEDITORTYPEa.Add("reviser")
  ' FMain.cbEDITORTYPEa.Add("collaborator")
  ' FMain.cbEDITORTYPEa.Add("cordinator")
  ' FMain.cbEDITORTYPEa.Add("organizator")
  '
  ' FMain.cbEDITORTYPEb.Add("")
  ' FMain.cbEDITORTYPEb.Add("editor")
  ' FMain.cbEDITORTYPEb.Add("compiler")
  ' FMain.cbEDITORTYPEb.Add("direction")
  ' FMain.cbEDITORTYPEb.Add("founder")
  ' FMain.cbEDITORTYPEb.Add("continuator")
  ' FMain.cbEDITORTYPEb.Add("redactor")
  ' FMain.cbEDITORTYPEb.Add("reviser")
  ' FMain.cbEDITORTYPEb.Add("collaborator")
  ' FMain.cbEDITORTYPEb.Add("cordinator")
  ' FMain.cbEDITORTYPEb.Add("organizator")
  '
  ' FMain.cbEDITORTYPEc.Add("")
  ' FMain.cbEDITORTYPEc.Add("editor")
  ' FMain.cbEDITORTYPEc.Add("compiler")
  ' FMain.cbEDITORTYPEc.Add("direction")
  ' FMain.cbEDITORTYPEc.Add("founder")
  ' FMain.cbEDITORTYPEc.Add("continuator")
  ' FMain.cbEDITORTYPEc.Add("redactor")
  ' FMain.cbEDITORTYPEc.Add("reviser")
  ' FMain.cbEDITORTYPEc.Add("collaborator")
  ' FMain.cbEDITORTYPEc.Add("cordinator")
  ' FMain.cbEDITORTYPEc.Add("organizator")

  FMain.cmbEprintType.Add("")
  FMain.cmbEprintType.Add("arXiv")
  FMain.cmbEprintType.Add("PubMed")
  FMain.cmbEprintType.Add("JSTOR")
  FMain.cmbEprintType.Add("Handle System (HDL)")
  FMain.cmbEprintType.Add("URL")
  FMain.cmbEprintType.Add("DOI")

End

Public Sub LimpiarCamposBIB()

  FMain.cmbTipoDeEntrada.Clear
  FMain.txtClaveBibtex.Text = ""
  FMain.cmbTipoDeEntrada.Clear
  FMain.txtAuthor.Text = ""

End

Public Sub MostrarRefereciasEnTableViewBibtexEnCurso(iRow As Integer)

  With FMain
    .idBibtex.Text = .gvReferenciasEnCurso[iRow, 0].Text
    .idRevista.Text = .gvReferenciasEnCurso[iRow, 1].Text
    .txtAuthor.Text = .gvReferenciasEnCurso[iRow, 2].Text
    .txtTitle.Text = .gvReferenciasEnCurso[iRow, 3].Text
    .txtClaveBibtex.Text = .gvReferenciasEnCurso[iRow, 5].Text
  End With

End
